window.wp=window.wp||{},jQuery(document).ready(function(e){function t(){var e=h.width();W={windowHeight:h.height(),windowWidth:e,adminBarHeight:e>600?d.outerHeight():0,toolsHeight:y.outerHeight()||0,menuBarHeight:N.outerHeight()||0,visualTopHeight:b.outerHeight()||0,textTopHeight:E.outerHeight()||0,bottomHeight:T.outerHeight()||0,statusBarHeight:C.outerHeight()||0,sideSortablesHeight:k.height()||0},W.menuBarHeight<3&&(W.menuBarHeight=0)}function n(e){var t,n,r,i,s,o=jQuery.ui.keyCode,u=e.keyCode,a=document.createRange(),f=S[0].selectionStart,l=S[0].selectionEnd,c=x[0].firstChild,h=10;if(!f||!l||f===l){try{a.setStart(c,f),a.setEnd(c,l+1)}catch(p){}t=a.getBoundingClientRect(),t.height&&(n=t.top-h,r=n+t.height+h,i=W.adminBarHeight+W.toolsHeight+W.textTopHeight,s=W.windowHeight-W.bottomHeight,i>n&&(u===o.UP||u===o.LEFT||u===o.BACKSPACE)?window.scrollTo(window.pageXOffset,n+window.pageYOffset-i):r>s&&window.scrollTo(window.pageXOffset,r+window.pageYOffset-s))}}function r(){if(!(l&&!l.isHidden()||!l&&"tinymce"===z)){var e,t=S.height();x.width(S.width()-22),x.text(S.val()+"&nbsp;"),e=x.height(),U>e&&(e=U),e!==t&&(S.height(e),i())}}function i(e){if(!O||!O.settings.visible){var n,i,s,o,u,a,f,c,d,m=h.scrollTop(),M="scroll"!==e,_=l&&!l.isHidden(),D=U,I=A.offset().top,z=1,X=g.width();(M||!W.windowHeight)&&t(),_||"resize"!==e||r(),_?(n=b,i=w,f=W.visualTopHeight):(n=E,i=S,f=W.textTopHeight),a=n.parent().offset().top,c=i.offset().top,d=i.outerHeight(),u=_?U+f:U+20,u=d>u+5,u?((!P||M)&&m>=a-W.toolsHeight-W.adminBarHeight&&m<=a-W.toolsHeight-W.adminBarHeight+d-D?(P=!0,y.css({position:"fixed",top:W.adminBarHeight,width:X}),_&&N.length&&N.css({position:"fixed",top:W.adminBarHeight+W.toolsHeight,width:X-2*z-(_?0:n.outerWidth()-n.width())}),n.css({position:"fixed",top:W.adminBarHeight+W.toolsHeight+W.menuBarHeight,width:X-2*z-(_?0:n.outerWidth()-n.width())})):(P||M)&&(m<=a-W.toolsHeight-W.adminBarHeight?(P=!1,y.css({position:"absolute",top:0,width:X}),_&&N.length&&N.css({position:"absolute",top:0,width:X-2*z}),n.css({position:"absolute",top:W.menuBarHeight,width:X-2*z-(_?0:n.outerWidth()-n.width())})):m>=a-W.toolsHeight-W.adminBarHeight+d-D&&(P=!1,y.css({position:"absolute",top:d-D,width:X}),_&&N.length&&N.css({position:"absolute",top:d-D,width:X-2*z}),n.css({position:"absolute",top:d-D+W.menuBarHeight,width:X-2*z-(_?0:n.outerWidth()-n.width())}))),(!H||M)&&m+W.windowHeight<=c+d+W.bottomHeight+W.statusBarHeight+z?(H=!0,C.css({position:"fixed",bottom:W.bottomHeight,width:X-2*z}),T.css({position:"fixed",bottom:0,width:X})):(H||M)&&m+W.windowHeight>c+d+W.bottomHeight+W.statusBarHeight-z&&(H=!1,C.add(T).attr("style",""))):M&&(y.css({position:"absolute",top:0,width:X}),_&&N.length&&N.css({position:"absolute",top:0,width:X-2*z}),n.css({position:"absolute",top:W.menuBarHeight,width:X-2*z-(_?0:n.outerWidth()-n.width())}),C.add(T).attr("style","")),L.width()<300&&W.windowWidth>600&&p.height()>k.height()+I+120&&W.windowHeight<d?(W.sideSortablesHeight+q+R>W.windowHeight||B||j?I>=m+q?(k.attr("style",""),B=j=!1):m>F?B?(B=!1,s=k.offset().top-W.adminBarHeight,o=v.offset().top,o<s+W.sideSortablesHeight+R&&(s=o-W.sideSortablesHeight-12),k.css({position:"absolute",top:s,bottom:""})):!j&&W.sideSortablesHeight+k.offset().top+R<m+W.windowHeight&&(j=!0,k.css({position:"fixed",top:"auto",bottom:R})):F>m&&(j?(j=!1,s=k.offset().top-R,o=v.offset().top,o<s+W.sideSortablesHeight+R&&(s=o-W.sideSortablesHeight-12),k.css({position:"absolute",top:s,bottom:""})):!B&&k.offset().top>=m+q&&(B=!0,k.css({position:"fixed",top:q,bottom:""}))):(m>=I-q?k.css({position:"fixed",top:q}):k.attr("style",""),B=j=!1),F=m):(k.attr("style",""),B=j=!1),M&&(g.css({paddingTop:W.toolsHeight}),_?w.css({paddingTop:W.visualTopHeight+W.menuBarHeight}):(S.css({marginTop:W.textTopHeight}),x.width(X-20-2*z)))}}function s(){r(),i()}function o(e){for(var t=1;6>t;t++)setTimeout(e,500*t)}function u(){clearTimeout(c),c=setTimeout(i,100)}function a(){window.pageYOffset&&window.pageYOffset>I&&window.scrollTo(window.pageXOffset,0),m.addClass("wp-editor-expand"),h.on("scroll.editor-expand resize.editor-expand",function(e){i(e.type),u()}),p.on("wp-collapse-menu.editor-expand postboxes-columnchange.editor-expand editor-classchange.editor-expand",i).on("postbox-toggled.editor-expand",function(){!B&&!j&&window.pageYOffset>q&&(j=!0,window.scrollBy(0,-1),i(),window.scrollBy(0,1)),i()}).on("wp-window-resized.editor-expand",function(){l&&!l.isHidden()?l.execCommand("wpAutoResize"):r()}),S.on("focus.editor-expand input.editor-expand propertychange.editor-expand",r),S.on("keyup.editor-expand",n),M(),O&&O.pubsub.subscribe("hidden",s),l&&(l.settings.wp_autoresize_on=!0,l.execCommand("wpAutoResizeOn"),l.isHidden()||l.execCommand("wpAutoResize")),(!l||l.isHidden())&&r(),i()}function f(){var t=window.getUserSetting("ed_size");window.pageYOffset&&window.pageYOffset>I&&window.scrollTo(window.pageXOffset,0),m.removeClass("wp-editor-expand"),h.off(".editor-expand"),p.off(".editor-expand"),S.off(".editor-expand"),D(),O&&O.pubsub.unsubscribe("hidden",s),e.each([b,E,y,N,T,C,g,w,S,k],function(e,t){t&&t.attr("style","")}),P=H=B=j=!1,l&&(l.settings.wp_autoresize_on=!1,l.execCommand("wpAutoResizeOff"),l.isHidden()||(S.hide(),t&&l.theme.resizeTo(null,t))),t&&S.height(t)}var l,c,h=e(window),p=e(document),d=e("#wpadminbar"),v=e("#wpfooter"),m=e("#postdivrich"),g=e("#wp-content-wrap"),y=e("#wp-content-editor-tools"),b=e(),w=e(),E=e("#ed_toolbar"),S=e("#content"),x=e('<div id="content-textarea-clone"></div>'),T=e("#post-status-info"),N=e(),C=e(),k=e("#side-sortables"),L=e("#postbox-container-1"),A=e("#post-body"),O=window.wp.editor&&window.wp.editor.fullscreen,M=function(){},D=function(){},P=!1,H=!1,B=!1,j=!1,F=0,I=130,q=56,R=20,U=300,z=window.getUserSetting("editor"),W={windowHeight:0,windowWidth:0,adminBarHeight:0,toolsHeight:0,menuBarHeight:0,visualTopHeight:0,textTopHeight:0,bottomHeight:0,statusBarHeight:0,sideSortablesHeight:0};x.insertAfter(S),x.css({"font-family":S.css("font-family"),"font-size":S.css("font-size"),"line-height":S.css("line-height"),"white-space":"pre-wrap","word-wrap":"break-word"}),p.on("tinymce-editor-init.editor-expand",function(t,n){function s(){var e,t,r=n.selection.getNode();return t=n.plugins.wpview&&(e=n.plugins.wpview.getView(r))?e.getBoundingClientRect():r.getBoundingClientRect(),t.height?t:!1}function u(e){var t,r,i,o,u=tinymce.util.VK,a=e.keyCode,f=s(),l=10;f&&(47>=a&&a!==u.SPACEBAR&&a!==u.ENTER&&a!==u.DELETE&&a!==u.BACKSPACE&&a!==u.UP&&a!==u.LEFT&&a!==u.DOWN&&a!==u.UP||a>=91&&93>=a||a>=112&&123>=a||144===a||145===a||(t=f.top+n.iframeElement.getBoundingClientRect().top,r=t+f.height,t-=l,r+=l,i=W.adminBarHeight+W.toolsHeight+W.menuBarHeight+W.visualTopHeight,o=W.windowHeight-W.bottomHeight-W.statusBarHeight,o-i<f.height||(i>t&&(a===u.UP||a===u.LEFT||a===u.BACKSPACE)?window.scrollTo(window.pageXOffset,t+window.pageYOffset-i):r>o&&window.scrollTo(window.pageXOffset,r+window.pageYOffset-o))))}function a(){h.on("scroll.mce-float-panels",c),setTimeout(function(){n.execCommand("wpAutoResize"),i()},300)}function f(){h.off("scroll.mce-float-panels"),setTimeout(function(){var e=g.offset().top;window.pageYOffset>e&&window.scrollTo(window.pageXOffset,e-W.adminBarHeight),r(),i()},100),i()}var c=_.debounce(function(){!e(".mce-floatpanel:hover").length&&tinymce.ui.FloatPanel.hideAll(),e(".mce-tooltip").hide()},1e3,!0);"content"===n.id&&(l=n,n.settings.autoresize_min_height=U,b=g.find(".mce-toolbar-grp"),w=g.find(".mce-edit-area"),C=g.find(".mce-statusbar"),N=g.find(".mce-menubar"),M=function(){n.on("keyup",u),n.on("show",a),n.on("hide",f),n.on("setcontent wp-autoresize wp-toolbar-toggle",i),h.off("scroll.mce-float-panels").on("scroll.mce-float-panels",c)},D=function(){n.off("keyup",u),n.off("show",a),n.off("hide",f),n.off("setcontent wp-autoresize wp-toolbar-toggle",i),h.off("scroll.mce-float-panels")},m.hasClass("wp-editor-expand")&&(M(),o(i)))}),m.hasClass("wp-editor-expand")&&(a(),g.hasClass("html-active")&&o(function(){i(),r()})),e("#adv-settings .editor-expand").show(),e("#editor-expand-toggle").on("change.editor-expand",function(){e(this).prop("checked")?(a(),window.setUserSetting("editor_expand","on")):(f(),window.setUserSetting("editor_expand","off"))}),window.editorExpand={on:a,off:f}});