/* global tinymce */window.wp=window.wp||{};jQuery(document).ready(function(e){function B(){var e=t.width();H={windowHeight:t.height(),windowWidth:e,adminBarHeight:e>600?r.outerHeight():0,toolsHeight:u.outerHeight()||0,menuBarHeight:d.outerHeight()||0,visualTopHeight:a.outerHeight()||0,textTopHeight:l.outerHeight()||0,bottomHeight:p.outerHeight()||0,statusBarHeight:v.outerHeight()||0,sideSortablesHeight:m.height()||0};H.menuBarHeight<3&&(H.menuBarHeight=0)}function j(e){var t=jQuery.ui.keyCode,n=e.keyCode,r=document.createRange(),i=c[0].selectionStart,s=c[0].selectionEnd,o=h[0].firstChild,u=10,a,f,l,p,d;if(i&&s&&i!==s)return;try{r.setStart(o,i);r.setEnd(o,s+1)}catch(v){}a=r.getBoundingClientRect();if(!a.height)return;f=a.top-u;l=f+a.height+u;p=H.adminBarHeight+H.toolsHeight+H.textTopHeight;d=H.windowHeight-H.bottomHeight;f<p&&(n===t.UP||n===t.LEFT||n===t.BACKSPACE)?window.scrollTo(window.pageXOffset,f+window.pageYOffset-p):l>d&&window.scrollTo(window.pageXOffset,l+window.pageYOffset-d)}function F(){if(w&&!w.isHidden()||!w&&P==="tinymce")return;var e=c.height(),t;h.width(c.width()-22);h.text(c.val()+"&nbsp;");t=h.height();t<D&&(t=D);if(t===e)return;c.height(t);I()}function I(e){if(b&&b.settings.visible)return;var r=t.scrollTop(),s=e!=="scroll",E=w&&!w.isHidden(),S=D,k=y.offset().top,A=1,_=o.width(),P,j,I,q,R,U,z,W,X;(s||!H.windowHeight)&&B();!E&&e==="resize"&&F();if(E){P=a;j=f;z=H.visualTopHeight}else{P=l;j=c;z=H.textTopHeight}U=P.parent().offset().top;W=j.offset().top;X=j.outerHeight();R=E?D+z:D+20;R=X>R+5;if(!R){if(s){u.css({position:"absolute",top:0,width:_});E&&d.length&&d.css({position:"absolute",top:0,width:_-A*2});P.css({position:"absolute",top:H.menuBarHeight,width:_-A*2-(E?0:P.outerWidth()-P.width())});v.add(p).attr("style","")}}else{if((!x||s)&&r>=U-H.toolsHeight-H.adminBarHeight&&r<=U-H.toolsHeight-H.adminBarHeight+X-S){x=!0;u.css({position:"fixed",top:H.adminBarHeight,width:_});E&&d.length&&d.css({position:"fixed",top:H.adminBarHeight+H.toolsHeight,width:_-A*2-(E?0:P.outerWidth()-P.width())});P.css({position:"fixed",top:H.adminBarHeight+H.toolsHeight+H.menuBarHeight,width:_-A*2-(E?0:P.outerWidth()-P.width())})}else if(x||s)if(r<=U-H.toolsHeight-H.adminBarHeight){x=!1;u.css({position:"absolute",top:0,width:_});E&&d.length&&d.css({position:"absolute",top:0,width:_-A*2});P.css({position:"absolute",top:H.menuBarHeight,width:_-A*2-(E?0:P.outerWidth()-P.width())})}else if(r>=U-H.toolsHeight-H.adminBarHeight+X-S){x=!1;u.css({position:"absolute",top:X-S,width:_});E&&d.length&&d.css({position:"absolute",top:X-S,width:_-A*2});P.css({position:"absolute",top:X-S+H.menuBarHeight,width:_-A*2-(E?0:P.outerWidth()-P.width())})}if((!T||s)&&r+H.windowHeight<=W+X+H.bottomHeight+H.statusBarHeight+A){T=!0;v.css({position:"fixed",bottom:H.bottomHeight,width:_-A*2});p.css({position:"fixed",bottom:0,width:_})}else if((T||s)&&r+H.windowHeight>W+X+H.bottomHeight+H.statusBarHeight-A){T=!1;v.add(p).attr("style","")}}if(g.width()<300&&H.windowWidth>600&&n.height()>m.height()+k+120&&H.windowHeight<X){if(H.sideSortablesHeight+O+M>H.windowHeight||N||C){if(r+O<=k){m.attr("style","");N=C=!1}else if(r>L){if(N){N=!1;I=m.offset().top-H.adminBarHeight;q=i.offset().top;q<I+H.sideSortablesHeight+M&&(I=q-H.sideSortablesHeight-12);m.css({position:"absolute",top:I,bottom:""})}else if(!C&&H.sideSortablesHeight+m.offset().top+M<r+H.windowHeight){C=!0;m.css({position:"fixed",top:"auto",bottom:M})}}else if(r<L)if(C){C=!1;I=m.offset().top-M;q=i.offset().top;q<I+H.sideSortablesHeight+M&&(I=q-H.sideSortablesHeight-12);m.css({position:"absolute",top:I,bottom:""})}else if(!N&&m.offset().top>=r+O){N=!0;m.css({position:"fixed",top:O,bottom:""})}}else{r>=k-O?m.css({position:"fixed",top:O}):m.attr("style","");N=C=!1}L=r}else{m.attr("style","");N=C=!1}if(s){o.css({paddingTop:H.toolsHeight});if(E)f.css({paddingTop:H.visualTopHeight+H.menuBarHeight});else{c.css({marginTop:H.textTopHeight});h.width(_-20-A*2)}}}function q(){F();I()}function R(e){for(var t=1;t<6;t++)setTimeout(e,500*t)}function U(){clearTimeout(k);k=setTimeout(I,100)}function z(){window.pageYOffset&&window.pageYOffset>A&&window.scrollTo(window.pageXOffset,0);s.addClass("wp-editor-expand");t.on("scroll.editor-expand resize.editor-expand",function(e){I(e.type);U()});n.on("wp-collapse-menu.editor-expand postboxes-columnchange.editor-expand editor-classchange.editor-expand",I).on("postbox-toggled.editor-expand",function(){if(!N&&!C&&window.pageYOffset>O){C=!0;window.scrollBy(0,-1);I();window.scrollBy(0,1)}I()}).on("wp-window-resized.editor-expand",function(){w&&!w.isHidden()?w.execCommand("wpAutoResize"):F()});c.on("focus.editor-expand input.editor-expand propertychange.editor-expand",F);c.on("keyup.editor-expand",j);E();b&&b.pubsub.subscribe("hidden",q);if(w){w.settings.wp_autoresize_on=!0;w.execCommand("wpAutoResizeOn");w.isHidden()||w.execCommand("wpAutoResize")}(!w||w.isHidden())&&F();I()}function W(){var r=window.getUserSetting("ed_size");window.pageYOffset&&window.pageYOffset>A&&window.scrollTo(window.pageXOffset,0);s.removeClass("wp-editor-expand");t.off(".editor-expand");n.off(".editor-expand");c.off(".editor-expand");S();b&&b.pubsub.unsubscribe("hidden",q);e.each([a,l,u,d,p,v,o,f,c,m],function(e,t){t&&t.attr("style","")});x=T=N=C=!1;if(w){w.settings.wp_autoresize_on=!1;w.execCommand("wpAutoResizeOff");if(!w.isHidden()){c.hide();r&&w.theme.resizeTo(null,r)}}r&&c.height(r)}var t=e(window),n=e(document),r=e("#wpadminbar"),i=e("#wpfooter"),s=e("#postdivrich"),o=e("#wp-content-wrap"),u=e("#wp-content-editor-tools"),a=e(),f=e(),l=e("#ed_toolbar"),c=e("#content"),h=e('<div id="content-textarea-clone"></div>'),p=e("#post-status-info"),d=e(),v=e(),m=e("#side-sortables"),g=e("#postbox-container-1"),y=e("#post-body"),b=window.wp.editor&&window.wp.editor.fullscreen,w,E=function(){},S=function(){},x=!1,T=!1,N=!1,C=!1,k,L=0,A=130,O=56,M=20,D=300,P=window.getUserSetting("editor"),H={windowHeight:0,windowWidth:0,adminBarHeight:0,toolsHeight:0,menuBarHeight:0,visualTopHeight:0,textTopHeight:0,bottomHeight:0,statusBarHeight:0,sideSortablesHeight:0};h.insertAfter(c);h.css({"font-family":c.css("font-family"),"font-size":c.css("font-size"),"line-height":c.css("line-height"),"white-space":"pre-wrap","word-wrap":"break-word"});n.on("tinymce-editor-init.editor-expand",function(n,r){function u(){var e=r.selection.getNode(),t,n;r.plugins.wpview&&(t=r.plugins.wpview.getView(e))?n=t.getBoundingClientRect():n=e.getBoundingClientRect();return n.height?n:!1}function l(e){var t=tinymce.util.VK,n=e.keyCode,i=u(),s=10,o,a,f,l;if(!i)return;if(n<=47&&n!==t.SPACEBAR&&n!==t.ENTER&&n!==t.DELETE&&n!==t.BACKSPACE&&n!==t.UP&&n!==t.LEFT&&n!==t.DOWN&&n!==t.UP)return;if(n>=91&&n<=93||n>=112&&n<=123||n===144||n===145)return;o=i.top+r.iframeElement.getBoundingClientRect().top;a=o+i.height;o-=s;a+=s;f=H.adminBarHeight+H.toolsHeight+H.menuBarHeight+H.visualTopHeight;l=H.windowHeight-H.bottomHeight-H.statusBarHeight;if(l-f<i.height)return;o<f&&(n===t.UP||n===t.LEFT||n===t.BACKSPACE)?window.scrollTo(window.pageXOffset,o+window.pageYOffset-f):a>l&&window.scrollTo(window.pageXOffset,a+window.pageYOffset-l)}function c(){t.on("scroll.mce-float-panels",i);setTimeout(function(){r.execCommand("wpAutoResize");I()},300)}function h(){t.off("scroll.mce-float-panels");setTimeout(function(){var e=o.offset().top;window.pageYOffset>e&&window.scrollTo(window.pageXOffset,e-H.adminBarHeight);F();I()},100);I()}var i=_.debounce(function(){!e(".mce-floatpanel:hover").length&&tinymce.ui.FloatPanel.hideAll();e(".mce-tooltip").hide()},1e3,!0);if(r.id!=="content")return;w=r;r.settings.autoresize_min_height=D;a=o.find(".mce-toolbar-grp");f=o.find(".mce-edit-area");v=o.find(".mce-statusbar");d=o.find(".mce-menubar");E=function(){r.on("keyup",l);r.on("show",c);r.on("hide",h);r.on("setcontent wp-autoresize wp-toolbar-toggle",I);t.off("scroll.mce-float-panels").on("scroll.mce-float-panels",i)};S=function(){r.off("keyup",l);r.off("show",c);r.off("hide",h);r.off("setcontent wp-autoresize wp-toolbar-toggle",I);t.off("scroll.mce-float-panels")};if(s.hasClass("wp-editor-expand")){E();R(I)}});if(s.hasClass("wp-editor-expand")){z();o.hasClass("html-active")&&R(function(){I();F()})}e("#adv-settings .editor-expand").show();e("#editor-expand-toggle").on("change.editor-expand",function(){if(e(this).prop("checked")){z();window.setUserSetting("editor_expand","on")}else{W();window.setUserSetting("editor_expand","off")}});window.editorExpand={on:z,off:W}});