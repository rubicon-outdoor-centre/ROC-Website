tinymce.PluginManager.add("wpeditimage",function(e){function t(t){return!!e.dom.getAttrib(t,"data-mce-placeholder")||!!e.dom.getAttrib(t,"data-mce-object")}function n(){var t,n=[];return g(["wp_img_alignleft","wp_img_aligncenter","wp_img_alignright","wp_img_alignnone","wp_img_edit","wp_img_remove"],function(r){function i(){var t=e.selection;r.settings.stateSelector&&t.selectorChanged(r.settings.stateSelector,function(e){r.active(e)},!0),r.settings.disabledStateSelector&&t.selectorChanged(r.settings.disabledStateSelector,function(e){r.disabled(e)})}var s;"|"===r?t=null:m.has(r)?(r={type:r},v.toolbar_items_size&&(r.size=v.toolbar_items_size),n.push(r),t=null):(t||(t={type:"buttongroup",items:[]},n.push(t)),e.buttons[r]&&(s=r,r=e.buttons[s],"function"==typeof r&&(r=r()),r.type=r.type||"button",v.toolbar_items_size&&(r.size=v.toolbar_items_size),r=m.create(r),t.items.push(r),e.initialized?i():e.on("init",i)))}),{type:"panel",layout:"stack",classes:"toolbar-grp inline-toolbar-grp wp-image-toolbar",ariaRoot:!0,ariaRemember:!0,items:[{type:"toolbar",layout:"flow",items:n}]}}function r(){b||h.hide()}function i(t){return t.replace(/(?:<p>)?\[(?:wp_)?caption([^\]]+)\]([\s\S]+?)\[\/(?:wp_)?caption\](?:<\/p>)?/g,function(t,n,r){var i,s,o,u,a,f,l=tinymce.trim;return i=n.match(/id=['"]([^'"]*)['"] ?/),i&&(n=n.replace(i[0],"")),s=n.match(/align=['"]([^'"]*)['"] ?/),s&&(n=n.replace(s[0],"")),o=n.match(/class=['"]([^'"]*)['"] ?/),o&&(n=n.replace(o[0],"")),f=n.match(/width=['"]([0-9]*)['"] ?/),f&&(n=n.replace(f[0],"")),r=l(r),a=r.match(/((?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?)([\s\S]*)/i),a&&a[2]?(u=l(a[2]),a=l(a[1])):(u=l(n).replace(/caption=['"]/,"").replace(/['"]$/,""),a=r),i=i&&i[1]?i[1].replace(/[<>&]+/g,""):"",s=s&&s[1]?s[1]:"alignnone",o=o&&o[1]?" "+o[1].replace(/[<>&]+/g,""):"",!f&&a&&(f=a.match(/width=['"]([0-9]*)['"]/)),f&&f[1]&&(f=f[1]),f&&u?(f=parseInt(f,10),e.getParam("wpeditimage_html5_captions")||(f+=10),'<div class="mceTemp"><dl id="'+i+'" class="wp-caption '+s+o+'" style="width: '+f+'px"><dt class="wp-caption-dt">'+a+'</dt><dd class="wp-caption-dd">'+u+"</dd></dl></div>"):r})}function s(e){return e.replace(/<div (?:id="attachment_|class="mceTemp)[^>]*>([\s\S]+?)<\/div>/g,function(e,t){var n="";return-1===t.indexOf("<img ")?(n=t.match(/<dd [^>]+>([\s\S]+?)<\/dd>/i),n&&n[1]?"<p>"+n[1]+"</p>":""):(n=t.replace(/\s*<dl ([^>]+)>\s*<dt [^>]+>([\s\S]+?)<\/dt>\s*<dd [^>]+>([\s\S]*?)<\/dd>\s*<\/dl>\s*/gi,function(e,t,n,r){var i,s,o,u;return u=n.match(/width="([0-9]*)"/),u=u&&u[1]?u[1]:"",u&&r?(i=t.match(/id="([^"]*)"/),i=i&&i[1]?i[1]:"",s=t.match(/class="([^"]*)"/),s=s&&s[1]?s[1]:"",o=s.match(/align[a-z]+/i)||"alignnone",s=s.replace(/wp-caption ?|align[a-z]+ ?/gi,""),s&&(s=' class="'+s+'"'),r=r.replace(/\r\n|\r/g,"\n").replace(/<[a-zA-Z0-9]+( [^<>]+)?>/g,function(e){return e.replace(/[\r\n\t]+/," ")}),r=r.replace(/\s*\n\s*/g,"<br />"),'[caption id="'+i+'" align="'+o+'" width="'+u+'"'+s+"]"+n+" "+r+"[/caption]"):n}),-1===n.indexOf("[caption")&&(n=t.replace(/[\s\S]*?((?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?)(<p>[\s\S]*<\/p>)?[\s\S]*/gi,"<p>$1</p>$2")),n)})}function o(t){var n,r,i,s,o,u,a,f,l=[],c=e.dom,h=/^\d+$/;return i={attachment_id:!1,size:"custom",caption:"",align:"none",extraClasses:"",link:!1,linkUrl:"",linkClassName:"",linkTargetBlank:!1,linkRel:"",title:""},i.url=c.getAttrib(t,"src"),i.alt=c.getAttrib(t,"alt"),i.title=c.getAttrib(t,"title"),a=c.getAttrib(t,"width"),f=c.getAttrib(t,"height"),(!h.test(a)||parseInt(a,10)<1)&&(a=t.naturalWidth||t.width),(!h.test(f)||parseInt(f,10)<1)&&(f=t.naturalHeight||t.height),i.customWidth=i.width=a,i.customHeight=i.height=f,n=tinymce.explode(t.className," "),r=[],tinymce.each(n,function(e){/^wp-image/.test(e)?i.attachment_id=parseInt(e.replace("wp-image-",""),10):/^align/.test(e)?i.align=e.replace("align",""):/^size/.test(e)?i.size=e.replace("size-",""):r.push(e)}),i.extraClasses=r.join(" "),s=c.getParents(t,".wp-caption"),s.length&&(s=s[0],n=s.className.split(" "),tinymce.each(n,function(e){/^align/.test(e)?i.align=e.replace("align",""):e&&"wp-caption"!==e&&l.push(e)}),i.captionClassName=l.join(" "),o=c.select("dd.wp-caption-dd",s),o.length&&(o=o[0],i.caption=e.serializer.serialize(o).replace(/<br[^>]*>/g,"$&\n").replace(/^<p>/,"").replace(/<\/p>$/,""))),t.parentNode&&"A"===t.parentNode.nodeName&&(u=t.parentNode,i.linkUrl=c.getAttrib(u,"href"),i.linkTargetBlank="_blank"===c.getAttrib(u,"target")?!0:!1,i.linkRel=c.getAttrib(u,"rel"),i.linkClassName=u.className),i}function u(e){return e&&(!!e.textContent||!!e.innerText)}function a(t){return!t||-1===t.indexOf("<")&&-1===t.indexOf(">")?t:(p||(p=new tinymce.html.Serializer({},e.schema)),p.serialize(e.parser.parse(t,{forced_root_block:!1})))}function f(t,n){var r,i,s,o,f,l,c,h,p,d,v,m,g,y,b,w,E=e.dom;r=tinymce.explode(n.extraClasses," "),r||(r=[]),n.caption||r.push("align"+n.align),n.attachment_id&&(r.push("wp-image-"+n.attachment_id),n.size&&"custom"!==n.size&&r.push("size-"+n.size)),y=n.width,b=n.height,"custom"===n.size&&(y=n.customWidth,b=n.customHeight),m={src:n.url,width:y||null,height:b||null,alt:n.alt,title:n.title||null,"class":r.join(" ")||null},E.setAttribs(t,m),g={href:n.linkUrl,rel:n.linkRel||null,target:n.linkTargetBlank?"_blank":null,"class":n.linkClassName||null},t.parentNode&&"A"===t.parentNode.nodeName&&!u(t.parentNode)?n.linkUrl?E.setAttribs(t.parentNode,g):E.remove(t.parentNode,!0):n.linkUrl&&((c=E.getParent(t,"a"))&&E.insertAfter(t,c),c=E.create("a",g),t.parentNode.insertBefore(c,t),c.appendChild(t)),h=e.dom.getParent(t,".mceTemp"),s=t.parentNode&&"A"===t.parentNode.nodeName&&!u(t.parentNode)?t.parentNode:t,n.caption?(n.caption=a(n.caption),v=n.attachment_id?"attachment_"+n.attachment_id:null,w="align"+(n.align||"none"),i="wp-caption "+w,n.captionClassName&&(i+=" "+n.captionClassName.replace(/[<>&]+/g,"")),e.getParam("wpeditimage_html5_captions")||(y=parseInt(y,10),y+=10),h?(d=E.select("dl.wp-caption",h),d.length&&E.setAttribs(d,{id:v,"class":i,style:"width: "+y+"px"}),p=E.select(".wp-caption-dd",h),p.length&&E.setHTML(p[0],n.caption)):(v=v?'id="'+v+'" ':"",o="<dl "+v+'class="'+i+'" style="width: '+y+'px"><dt class="wp-caption-dt"></dt><dd class="wp-caption-dd">'+n.caption+"</dd></dl>",l=E.create("div",{"class":"mceTemp"},o),(f=E.getParent(s,"p"))?(f.parentNode.insertBefore(l,f),E.isEmpty(f)&&E.remove(f)):s.parentNode.insertBefore(l,s),e.$(l).find("dt.wp-caption-dt").append(s))):h&&(f=E.create("p"),h.parentNode.insertBefore(f,h),f.appendChild(s),E.remove(h)),wp.media.events&&wp.media.events.trigger("editor:image-update",{editor:e,metadata:n,image:t}),e.nodeChanged()}function l(t){var n,r,i;return"undefined"!=typeof wp&&wp.media?(i=o(t),wp.media.events.trigger("editor:image-edit",{editor:e,metadata:i,image:t}),n=wp.media({frame:"image",state:"image-details",metadata:i}),wp.media.events.trigger("editor:frame-create",{frame:n}),r=function(r){e.focus(),e.undoManager.transact(function(){f(t,r)}),n.detach()},n.state("image-details").on("update",r),n.state("replace-image").on("replace",r),n.on("close",function(){e.focus(),n.detach()}),void n.open()):void e.execCommand("mceImage")}function c(t){var n;"DIV"===t.nodeName&&e.dom.hasClass(t,"mceTemp")?n=t:("IMG"===t.nodeName||"DT"===t.nodeName||"A"===t.nodeName)&&(n=e.dom.getParent(t,"div.mceTemp")),n?(e.selection.select(n.nextSibling?n.nextSibling:n.previousSibling?n.previousSibling:n.parentNode),e.selection.collapse(!0),e.dom.remove(n)):e.dom.remove(t),e.nodeChanged(),e.undoManager.add()}var h,p,d=tinymce.DOM,v=e.settings,m=tinymce.ui.Factory,g=tinymce.each,y=tinymce.Env.iOS,b=!0,w=tinymce.$("#postdivrich");return e.addButton("wp_img_remove",{tooltip:"Remove",icon:"dashicon dashicons-no",onclick:function(){c(e.selection.getNode())}}),e.addButton("wp_img_edit",{tooltip:"Edit ",icon:"dashicon dashicons-edit",onclick:function(){l(e.selection.getNode())}}),g({alignleft:"Align left",aligncenter:"Align center",alignright:"Align right",alignnone:"No alignment"},function(t,n){var r=n.slice(5);e.addButton("wp_img_"+n,{tooltip:t,icon:"dashicon dashicons-align-"+r,cmd:"alignnone"===n?"wpAlignNone":"Justify"+r.slice(0,1).toUpperCase()+r.slice(1),onPostRender:function(){var t=this;e.on("NodeChange",function(r){var i;"IMG"===r.element.nodeName&&(i=e.dom.getParent(r.element,".wp-caption")||r.element,t.active("alignnone"===n?!/\balign(left|center|right)\b/.test(i.className):e.dom.hasClass(i,n)))})}})}),h=m.create(n()).renderTo(document.body).hide(),h.reposition=function(){var t,n,r,i,s,o,u,a,f,l,c,h,p,v,m,g,b,w,E,S,x,T=this.getEl(),N=5,C=8,k=0,L=e.selection.getNode();return L&&"IMG"===L.nodeName?(s=window.pageYOffset||document.documentElement.scrollTop,o=tinymce.$("#wpadminbar")[0],u=tinymce.$(".mce-tinymce .mce-toolbar-grp")[0],a=L.getBoundingClientRect(),f=(a.left+a.right)/2,l=(a.top+a.bottom)/2,c=a.top,h=E-a.bottom,p=window.innerWidth,v=T.offsetWidth,m=v/2,g=document.getElementById(e.id+"_ifr"),b=d.getPos(g),w=g.offsetWidth,E=g.offsetHeight,S=T.offsetHeight,x=S+C+N,y?t=a.top+b.y+C:c>=x?(i=" mce-arrow-down",t=a.top+b.y-S-C):h>=x?(i=" mce-arrow-up",t=a.bottom+b.y):(t=N,i=l>=x?" mce-arrow-down":" mce-arrow-up"),r=u?d.getPos(u).y+u.clientHeight:b.y,s&&(o&&0===o.getBoundingClientRect().top&&(k=o.clientHeight),s+k>r&&(r=s+k)),t&&r&&r+N>t&&(t=r+N,i=""),n=f-m,n+=b.x,a.left<0||a.right>w?n=b.x+(w-v)/2:v>=p?(i+=" mce-arrow-full",n=0):0>n&&a.left+v>p||n+v>p&&a.right-v<0?n=(p-v)/2:n<b.x?(i+=" mce-arrow-left",n=a.left+b.x):n+v>w+b.x&&(i+=" mce-arrow-right",n=a.right-v+b.x),y||(T.className=T.className.replace(/ ?mce-arrow-[\w]+/g,""),T.className+=i),d.setStyles(T,{left:n,top:t}),this):this},y&&e.on("click",function(t){if("IMG"===t.target.nodeName){var n=t.target;window.setTimeout(function(){e.selection.select(n)},200)}else h.hide()}),e.on("nodechange",function(n){var r=y?350:100;return"IMG"!==n.element.nodeName||t(n.element)?void h.hide():void setTimeout(function(){var n=e.selection.getNode();"IMG"!==n.nodeName||t(n)?h.hide():h._visible?h.reposition():h.show()},r)}),h.on("show",function(){b=!1,this._visible&&(this.reposition(),d.addClass(this.getEl(),"mce-inline-toolbar-grp-active"))}),h.on("hide",function(){b=!0,d.removeClass(this.getEl(),"mce-inline-toolbar-grp-active")}),h.on("keydown",function(t){27===t.keyCode&&(r(),e.focus())}),d.bind(window,"resize scroll",function(){!b&&w.hasClass("wp-editor-expand")&&r()}),e.on("init",function(){e.dom.bind(e.getWin(),"scroll",r)}),e.on("blur hide",r),e.shortcuts.add("Alt+119","",function(){var e=h.find("toolbar")[0];e&&e.focus(!0)}),e.on("init",function(){var t=e.dom,n=e.getParam("wpeditimage_html5_captions")?"html5-captions":"html4-captions";t.addClass(e.getBody(),n),e.on("wpLoadImageForm",function(t){if(!e.getParam("wpeditimage_disable_captions")){var n={type:"textbox",flex:1,name:"caption",minHeight:60,multiline:!0,scroll:!0,label:"Image caption"};t.data.splice(t.data.length-1,0,n)}}),e.on("wpNewImageRefresh",function(e){var n,r;(n=t.getParent(e.node,"dl.wp-caption"))&&(n.style.width||(r=parseInt(e.node.clientWidth,10)+10,r=r?r+"px":"50%",t.setStyle(n,"width",r)))}),e.on("wpImageFormSubmit",function(n){var r,i,s,o,u,f=n.imgData.data,l=n.imgData.node,c=n.imgData.caption,h="",p="",d="";return f.id="__wp-temp-img-id",n.imgData.cancel=!0,f.style||(f.style=null),f.src?(c&&(c=c.replace(/\r\n|\r/g,"\n").replace(/<\/?[a-zA-Z0-9]+( [^<>]+)?>/g,function(e){return e.replace(/[\r\n\t]+/," ")}),c=c.replace(/(<br[^>]*>)\s*\n\s*/g,"$1").replace(/\s*\n\s*/g,"<br />"),c=a(c)),l?(u=l.id||null,t.setAttribs(l,f),r=t.getParent(l,"dl.wp-caption"),c?r?(i=t.select("dd.wp-caption-dd",r)[0])&&(i.innerHTML=c):(l.className&&(h=l.className.match(/wp-image-([0-9]+)/),p=l.className.match(/align(left|right|center|none)/)),p?(p=p[0],l.className=l.className.replace(/align(left|right|center|none)/g,"")):p="alignnone",p=' class="wp-caption '+p+'"',h&&(h=' id="attachment_'+h[1]+'"'),d=f.width||l.clientWidth,d&&(d=parseInt(d,10),e.getParam("wpeditimage_html5_captions")||(d+=10),d=' style="width: '+d+'px"'),s=l.parentNode&&"A"===l.parentNode.nodeName?l.parentNode:l,o="<dl "+h+p+d+'><dt class="wp-caption-dt"></dt><dd class="wp-caption-dd">'+c+"</dd></dl>",r=t.create("div",{"class":"mceTemp"},o),(i=t.getParent(s,"p"))?(i.parentNode.insertBefore(r,i),t.isEmpty(i)&&t.remove(i)):s.parentNode.insertBefore(r,s),e.$(r).find("dt.wp-caption-dt").append(s)):r&&(o=t.getOuterHTML("A"===l.parentNode.nodeName?l.parentNode:l),i=t.create("p",{},o),t.insertAfter(i,r.parentNode),e.selection.select(i),e.nodeChanged(),t.remove(r.parentNode))):(o=t.createHTML("img",f),c?(s=e.selection.getNode(),f.width&&(d=parseInt(f.width,10),e.getParam("wpeditimage_html5_captions")||(d+=10),d=' style="width: '+d+'px"'),o='<dl class="wp-caption alignnone"'+d+'><dt class="wp-caption-dt">'+o+'</dt><dd class="wp-caption-dd">'+c+"</dd></dl>",i="P"===s.nodeName?s:t.getParent(s,"p"),i&&"P"===i.nodeName?(r=t.create("div",{"class":"mceTemp"},o),i.parentNode.insertBefore(r,i),e.selection.select(r),e.nodeChanged(),t.isEmpty(i)&&t.remove(i)):e.selection.setContent('<div class="mceTemp">'+o+"</div>")):e.selection.setContent(o)),l=t.get("__wp-temp-img-id"),t.setAttrib(l,"id",u),void (n.imgData.node=l)):void (l&&(t.remove((r=t.getParent(l,"div.mceTemp"))?r:"A"===l.parentNode.nodeName?l.parentNode:l),e.nodeChanged()))}),e.on("wpLoadImageData",function(n){var r,i=n.imgData.data,s=n.imgData.node;(r=t.getParent(s,"dl.wp-caption"))&&(r=t.select("dd.wp-caption-dd",r)[0],r&&(i.caption=e.serializer.serialize(r).replace(/<br[^>]*>/g,"$&\n").replace(/^<p>/,"").replace(/<\/p>$/,"")))}),t.bind(e.getDoc(),"dragstart",function(n){var r=e.selection.getNode();"IMG"===r.nodeName&&t.getParent(r,".wp-caption")&&n.preventDefault()}),tinymce.Env.ie&&tinymce.Env.ie>10&&t.bind(e.getBody(),"mscontrolselect",function(n){"IMG"===n.target.nodeName&&t.getParent(n.target,".wp-caption")?e.getBody().focus():"DL"===n.target.nodeName&&t.hasClass(n.target,"wp-caption")&&n.target.focus()})}),e.on("ObjectResized",function(t){var n=t.target;"IMG"===n.nodeName&&e.undoManager.transact(function(){var r,i,s=e.dom;n.className=n.className.replace(/\bsize-[^ ]+/,""),(r=s.getParent(n,".wp-caption"))&&(i=t.width||s.getAttrib(n,"width"),i&&(i=parseInt(i,10),e.getParam("wpeditimage_html5_captions")||(i+=10),s.setStyle(r,"width",i+"px")))})}),e.on("BeforeExecCommand",function(t){var n,r,i,s,o,u=t.command,a=e.dom;if("mceInsertContent"===u)(n=a.getParent(e.selection.getNode(),"div.mceTemp"))&&(r=a.create("p"),a.insertAfter(r,n),e.selection.setCursorLocation(r,0),e.nodeChanged());else if("JustifyLeft"===u||"JustifyRight"===u||"JustifyCenter"===u||"wpAlignNone"===u){if(n=e.selection.getNode(),s="align"+u.slice(7).toLowerCase(),i=e.dom.getParent(n,".wp-caption"),"IMG"!==n.nodeName&&!i)return;n=i||n,o=e.dom.hasClass(n,s)?" alignnone":" "+s,n.className=n.className.replace(/ ?align(left|center|right|none)/g,"")+o,e.nodeChanged(),t.preventDefault(),h&&h.reposition(),e.fire("ExecCommand",{command:u,ui:t.ui,value:t.value})}}),e.on("keydown",function(t){var n,r,i,s,o=e.selection,u=t.keyCode,a=e.dom,f=tinymce.util.VK;if(u===f.ENTER)n=o.getNode(),r=a.getParent(n,"div.mceTemp"),r&&(a.events.cancel(t),tinymce.each(a.select("dt, dd",r),function(e){a.isEmpty(e)&&a.remove(e)}),s=tinymce.Env.ie&&tinymce.Env.ie<11?"":'<br data-mce-bogus="1" />',i=a.create("p",null,s),"DD"===n.nodeName?a.insertAfter(i,r):r.parentNode.insertBefore(i,r),e.nodeChanged(),o.setCursorLocation(i,0));else if((u===f.DELETE||u===f.BACKSPACE)&&(n=o.getNode(),"DIV"===n.nodeName&&a.hasClass(n,"mceTemp")?r=n:("IMG"===n.nodeName||"DT"===n.nodeName||"A"===n.nodeName)&&(r=a.getParent(n,"div.mceTemp")),r))return a.events.cancel(t),c(n),!1}),tinymce.Env.gecko&&e.on("undo redo",function(){"IMG"===e.selection.getNode().nodeName&&e.selection.collapse()}),e.wpSetImgCaption=function(e){return i(e)},e.wpGetImgCaption=function(e){return s(e)},e.on("BeforeSetContent",function(t){"raw"!==t.format&&(t.content=e.wpSetImgCaption(t.content))}),e.on("PostProcess",function(t){t.get&&(t.content=e.wpGetImgCaption(t.content))}),{_do_shcode:i,_get_shcode:s}});